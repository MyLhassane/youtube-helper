<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>YouTube Helper</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <button id="login">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ÙŠÙˆØªÙŠÙˆØ¨</button>
  <button id="get">ğŸ¬ Ø¬Ù„Ø¨ Ø¢Ø®Ø± ÙÙŠØ¯ÙŠÙˆ</button>
  <pre id="output"></pre>

  <script>
    const CLIENT_ID = "453345351977-9k7c7fnh5pqfgpm3pmjq2obq6a481v3b.apps.googleusercontent.com";
    const API_KEY = "AIzaSyDAfXNsg1Kk5cUkg__ToE13fqVp3NeUPCI"; // Ø£Ø¶Ù Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§
    const SCOPES   = "https://www.googleapis.com/auth/youtube.readonly";

    let tokenClient;
    let accessToken = null;

    // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© YouTube
    function loadClient() {
      gapi.client.setApiKey(API_KEY);
      return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest");
    }

    // ØªØ¬Ù‡ÙŠØ² login client
    window.onload = () => {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (resp) => {
          if (resp.error) {
            alert("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
            return;
          }
          accessToken = resp.access_token;
          alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
        },
      });

      gapi.load("client", loadClient);
    };

    document.getElementById("login").onclick = () => {
      tokenClient.requestAccessToken({prompt: 'consent'});
    };

    document.getElementById("get").onclick = async () => {
      if (!accessToken) {
        alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§");
        return;
      }

      try {
        const response = await gapi.client.youtube.activities.list({
          part: "snippet,contentDetails",
          mine: true,
          maxResults: 1
        });

        const item = response.result.items[0];
        let vidId = item?.contentDetails?.upload?.videoId ||
                    item?.contentDetails?.playlistItem?.resourceId?.videoId ||
                    item?.contentDetails?.recommendation?.resourceId?.videoId;

        if (!vidId) {
          document.getElementById("output").textContent = "âŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£Ø®ÙŠØ±";
          return;
        }

        const vres = await gapi.client.youtube.videos.list({
          part: "snippet",
          id: vidId
        });

        const snippet = vres.result.items[0].snippet;
        const text = "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: " + snippet.title + "\nØ§Ù„ÙˆØµÙ: " + snippet.description;

        document.getElementById("output").textContent = text;

        // Ù†Ø·Ù‚ Ø§Ù„Ù†Øµ
        let msg = new SpeechSynthesisUtterance(text);
        msg.lang = "ar-SA";
        speechSynthesis.speak(msg);

      } catch (err) {
        console.error("API error:", err);
        document.getElementById("output").textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
      }
    };
  </script>
</body>
</html>
